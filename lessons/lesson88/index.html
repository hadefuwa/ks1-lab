<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lesson 88: Clock Speed Challenge</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&display=swap" rel="stylesheet">
    <style>
        *{box-sizing:border-box;margin:0;padding:0;}
        body{font-family:'Fredoka',sans-serif;background:linear-gradient(135deg,#0f172a 0%,#1e293b 100%);min-height:100vh;display:flex;flex-direction:column;align-items:center;color:white;overflow:hidden;}
        .screen{position:fixed;top:0;left:0;width:100%;height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;background:rgba(15,23,42,0.97);z-index:50;text-align:center;padding:20px;}
        .hidden{display:none!important;}
        .big-btn{background:linear-gradient(135deg,#6366f1,#4338ca);border:none;padding:14px 52px;font-size:1.8rem;color:white;border-radius:60px;cursor:pointer;box-shadow:0 8px 24px rgba(99,102,241,0.5);font-family:inherit;font-weight:600;transition:transform 0.2s;margin-top:1.2rem;}
        .big-btn:hover{transform:scale(1.05) translateY(-2px);}
        #game{padding:16px;width:100%;max-width:500px;display:flex;flex-direction:column;align-items:center;}
        #prog-bar-wrap{width:90%;height:10px;background:rgba(255,255,255,0.15);border-radius:10px;margin:12px 0;}
        #prog-bar{height:100%;background:#6366f1;border-radius:10px;transition:width 0.4s;}
        #time-bar-wrap{width:90%;height:8px;background:rgba(255,255,255,0.1);border-radius:8px;margin-bottom:10px;}
        #time-bar{height:100%;background:#ef4444;border-radius:8px;transition:width 0.1s linear;}
        #digital-display{font-size:4rem;font-weight:700;background:#0f172a;color:#a5b4fc;border:2px solid #6366f1;border-radius:16px;padding:12px 32px;letter-spacing:4px;margin:10px 0;font-family:monospace;box-shadow:0 4px 20px rgba(99,102,241,0.3);}
        #prompt{font-size:1.3rem;font-weight:600;margin:8px 0 4px;color:#c7d2fe;}
        #choices{display:grid;grid-template-columns:1fr 1fr;gap:12px;width:100%;max-width:480px;margin-top:4px;}
        .clock-choice{background:rgba(99,102,241,0.12);border:2px solid rgba(99,102,241,0.4);border-radius:16px;padding:10px;cursor:pointer;display:flex;flex-direction:column;align-items:center;transition:all 0.2s;}
        .clock-choice:hover{background:rgba(99,102,241,0.3);transform:scale(1.04);}
        .clock-choice.correct{border-color:#22c55e;background:rgba(34,197,94,0.2);}
        .clock-choice.wrong{border-color:#ef4444;background:rgba(239,68,68,0.2);}
        #feedback{font-size:1.3rem;margin:6px;min-height:1.5rem;}
        #score-label{font-size:1.1rem;color:#a5b4fc;}
    </style>
</head>
<body>
<div id="start-screen" class="screen">
    <h1 style="font-size:2.4rem;margin-bottom:0.5rem">‚ö° Clock Speed Challenge</h1>
    <p style="color:#c7d2fe;font-size:1.1rem;margin-bottom:1rem">You'll see a digital time ‚Äî pick the matching clock face fast!<br>Answer before the red bar runs out!</p>
    <div style="font-size:3rem;background:#0f172a;color:#a5b4fc;border-radius:12px;padding:8px 20px;font-family:monospace;border:2px solid #6366f1">7:45</div>
    <button class="big-btn" onclick="startGame()">Go Fast! ‚ö°</button>
</div>
<div id="end-screen" class="screen hidden">
    <h1 style="font-size:2.6rem" id="end-title">üèÜ Time Master!</h1>
    <p style="color:#c7d2fe;font-size:1.2rem;margin:0.8rem 0" id="end-msg">Lightning fast!</p>
    <div style="font-size:2rem;color:#fde68a">Score: <strong id="final-score">0</strong></div>
    <button class="big-btn" onclick="finishLesson()">Finish ‚úÖ</button>
</div>
<div id="game" class="hidden">
    <div id="score-label">Score: <span id="score">0</span> &nbsp;|&nbsp; Q <span id="qnum">1</span>/10</div>
    <div id="prog-bar-wrap"><div id="prog-bar" style="width:0%"></div></div>
    <div id="time-bar-wrap"><div id="time-bar"></div></div>
    <div id="digital-display">0:00</div>
    <div id="prompt">Find this time on a clock!</div>
    <div id="choices"></div>
    <div id="feedback"></div>
</div>

<script>
const LESSON_ID=88; const TOTAL_Q=10; const TIME_LIMIT=7000;
let score=0,qNum=0,answered=false,timerAnim=null;

function buildClockSVG(hour,minute,size=110){
    const ns='http://www.w3.org/2000/svg';
    const svg=document.createElementNS(ns,'svg');
    svg.setAttribute('width',size); svg.setAttribute('height',size);
    svg.setAttribute('viewBox','0 0 300 300');
    const cx=150,cy=150;
    svg.appendChild(e('circle',{cx,cy,r:140,fill:'#1e293b',stroke:'#6366f1','stroke-width':'6'}));
    for(let i=1;i<=12;i++){const a=(i/12)*Math.PI*2-Math.PI/2;const t=e('text',{x:cx+Math.cos(a)*116,y:cy+Math.sin(a)*116,'text-anchor':'middle','dominant-baseline':'central','font-size':'22','font-weight':'700','font-family':'Fredoka',fill:'#c7d2fe'});t.textContent=i;svg.appendChild(t);}
    const mA=(minute/60)*360-90; const mR=mA*Math.PI/180;
    svg.appendChild(e('line',{x1:cx,y1:cy,x2:cx+Math.cos(mR)*112,y2:cy+Math.sin(mR)*112,stroke:'#94a3b8','stroke-width':'5','stroke-linecap':'round'}));
    const hA=((hour%12)/12)*360+(minute/60)*30-90; const hR=hA*Math.PI/180;
    svg.appendChild(e('line',{x1:cx,y1:cy,x2:cx+Math.cos(hR)*78,y2:cy+Math.sin(hR)*78,stroke:'#a5b4fc','stroke-width':'8','stroke-linecap':'round'}));
    svg.appendChild(e('circle',{cx,cy,r:5,fill:'#e0e7ff'}));
    return svg;
}
function e(tag,attrs){const el=document.createElementNS('http://www.w3.org/2000/svg',tag);for(const[k,v] of Object.entries(attrs))el.setAttribute(k,v);return el;}
function fmt(h,m){return `${h}:${m.toString().padStart(2,'0')}`;}

function startGame(){document.getElementById('start-screen').classList.add('hidden');document.getElementById('game').classList.remove('hidden');nextQ();}
function nextQ(){
    if(qNum>=TOTAL_Q){endGame();return;}
    qNum++;answered=false;
    document.getElementById('qnum').innerText=qNum; document.getElementById('feedback').innerText='';
    document.getElementById('prog-bar').style.width=`${((qNum-1)/TOTAL_Q)*100}%`;
    const hour=Math.floor(Math.random()*12)+1;
    const mOpts=[0,5,10,15,20,25,30,35,40,45,50,55];
    const minute=mOpts[Math.floor(Math.random()*mOpts.length)];
    document.getElementById('digital-display').innerText=fmt(hour,minute);
    const opts=genOptTimes(hour,minute);
    const choicesEl=document.getElementById('choices'); choicesEl.innerHTML='';
    opts.forEach(([h,m])=>{
        const div=document.createElement('div'); div.className='clock-choice';
        div.appendChild(buildClockSVG(h,m));
        div.onclick=()=>pick(div,fmt(h,m),fmt(hour,minute)); choicesEl.appendChild(div);
    });
    startTimer();
}
function genOptTimes(ch,cm){
    const mOpts=[0,5,10,15,20,25,30,35,40,45,50,55];
    const s=new Set([fmt(ch,cm)]); const pairs=[[ch,cm]];
    while(pairs.length<4){const h=Math.floor(Math.random()*12)+1;const m=mOpts[Math.floor(Math.random()*mOpts.length)];const k=fmt(h,m);if(!s.has(k)){s.add(k);pairs.push([h,m]);}}
    return pairs.sort(()=>Math.random()-0.5);
}
function startTimer(){
    clearTimeout(timerAnim);
    const bar=document.getElementById('time-bar');
    bar.style.transition='none'; bar.style.width='100%';
    requestAnimationFrame(()=>{bar.style.transition=`width ${TIME_LIMIT}ms linear`;bar.style.width='0%';});
    timerAnim=setTimeout(()=>{if(!answered){answered=true;document.getElementById('feedback').innerText='‚è± Too slow!';setTimeout(nextQ,900);}},TIME_LIMIT);
}
function pick(div,val,correct){
    if(answered)return; answered=true; clearTimeout(timerAnim);
    if(val===correct){div.classList.add('correct');score+=10;document.getElementById('score').innerText=score;document.getElementById('feedback').innerText='‚úÖ Fast!';confetti({particleCount:30,spread:60,origin:{y:0.5}});}
    else{div.classList.add('wrong');document.getElementById('feedback').innerText=`‚ùå It was ${correct}`;}
    setTimeout(nextQ,1000);
}
function endGame(){document.getElementById('game').classList.add('hidden');document.getElementById('end-screen').classList.remove('hidden');document.getElementById('final-score').innerText=score;confetti({particleCount:200,spread:120,origin:{y:0.5}});}
function finishLesson(){window.parent.postMessage({type:'lessonCompleted',lessonId:LESSON_ID},'*');}
</script>
</body>
</html>
