<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lesson 93: Calculate Change</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&display=swap" rel="stylesheet">
    <style>
        *{box-sizing:border-box;margin:0;padding:0;}
        body{font-family:'Fredoka',sans-serif;background:linear-gradient(135deg,#7c3aed 0%,#4c1d95 100%);min-height:100vh;display:flex;flex-direction:column;align-items:center;color:white;overflow:hidden;}
        .screen{position:fixed;top:0;left:0;width:100%;height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;background:rgba(76,29,149,0.97);z-index:50;text-align:center;padding:20px;}
        .hidden{display:none!important;}
        .big-btn{background:linear-gradient(135deg,#7c3aed,#6d28d9);border:none;padding:14px 52px;font-size:1.8rem;color:white;border-radius:60px;cursor:pointer;box-shadow:0 8px 24px rgba(124,58,237,0.5);font-family:inherit;font-weight:600;transition:transform 0.2s;margin-top:1.2rem;}
        .big-btn:hover{transform:scale(1.05) translateY(-2px);}
        #game{padding:20px;width:100%;max-width:500px;display:flex;flex-direction:column;align-items:center;}
        #prog-bar-wrap{width:90%;height:10px;background:rgba(255,255,255,0.25);border-radius:10px;margin:14px 0;}
        #prog-bar{height:100%;background:white;border-radius:10px;transition:width 0.4s;}
        #scenario{background:rgba(255,255,255,0.12);border-radius:16px;padding:18px;width:100%;margin:12px 0;text-align:center;}
        #item-emoji{font-size:3rem;}
        #scenario-text{font-size:1.3rem;margin-top:8px;line-height:1.5;}
        #prompt{font-size:1.5rem;font-weight:600;margin:10px 0;color:#ddd6fe;}
        #answer-area{display:flex;gap:10px;align-items:center;margin-top:8px;}
        #answer-input{font-size:2rem;font-family:inherit;font-weight:600;background:rgba(255,255,255,0.15);border:2px solid rgba(255,255,255,0.5);border-radius:14px;color:white;padding:10px 16px;width:140px;text-align:center;outline:none;}
        #answer-input::placeholder{color:rgba(255,255,255,0.4);}
        #check-btn{background:white;color:#7c3aed;border:none;border-radius:14px;padding:12px 24px;font-size:1.5rem;font-family:inherit;font-weight:700;cursor:pointer;}
        #check-btn:hover{background:#f5f3ff;}
        #feedback{font-size:1.4rem;margin:10px;min-height:1.8rem;}
        #score-label{font-size:1.1rem;color:#ddd6fe;}
    </style>
</head>
<body>
<div id="start-screen" class="screen">
    <h1 style="font-size:2.8rem;margin-bottom:0.5rem">üí∏ Calculate Change</h1>
    <p style="color:#ddd6fe;font-size:1.2rem;margin-bottom:1rem">You buy something and pay with a coin.<br>How much <strong>change</strong> do you get back?</p>
    <p style="color:#c4b5fd;font-size:1.1rem">Change = amount paid ‚àí price</p>
    <button class="big-btn" onclick="startGame()">Let's Shop! üõí</button>
</div>
<div id="end-screen" class="screen hidden">
    <h1 style="font-size:2.8rem">üéâ Perfect Change!</h1>
    <p style="color:#ddd6fe;font-size:1.2rem;margin:0.8rem 0">You're brilliant at giving change!</p>
    <div style="font-size:2rem;color:#fde68a">Score: <strong id="final-score">0</strong></div>
    <button class="big-btn" onclick="finishLesson()">Finish ‚úÖ</button>
</div>
<div id="game" class="hidden">
    <div id="score-label">Score: <span id="score">0</span> &nbsp;|&nbsp; Q <span id="qnum">1</span>/10</div>
    <div id="prog-bar-wrap"><div id="prog-bar" style="width:0%"></div></div>
    <div id="scenario">
        <div id="item-emoji">üçé</div>
        <div id="scenario-text"></div>
    </div>
    <div id="prompt">How much change do you get?</div>
    <div id="answer-area">
        <input id="answer-input" type="number" min="0" max="99" placeholder="?" autocomplete="off">
        <span style="font-size:1.6rem;font-weight:600">p</span>
        <button id="check-btn" onclick="checkAnswer()">Check ‚úì</button>
    </div>
    <div id="feedback"></div>
</div>

<script>
const LESSON_ID=93; const TOTAL_Q=10;
let score=0,qNum=0,changeAmt=0;
const ITEMS=[{e:'üçé',n:'apple'},{e:'üçä',n:'orange'},{e:'üçå',n:'banana'},{e:'‚úèÔ∏è',n:'pencil'},{e:'üßÅ',n:'cupcake'},{e:'üç´',n:'chocolate'},{e:'üéÄ',n:'ribbon'},{e:'üéà',n:'balloon'},{e:'üç≠',n:'lolly'},{e:'ü•ï',n:'carrot'}];

function startGame(){document.getElementById('start-screen').classList.add('hidden');document.getElementById('game').classList.remove('hidden');nextQ();}
function nextQ(){
    if(qNum>=TOTAL_Q){endGame();return;}
    qNum++;
    document.getElementById('qnum').innerText=qNum; document.getElementById('feedback').innerText='';
    document.getElementById('prog-bar').style.width=`${((qNum-1)/TOTAL_Q)*100}%`;
    document.getElementById('answer-input').value='';
    const item=ITEMS[Math.floor(Math.random()*ITEMS.length)];
    // price between 5-45p in 5p steps; paid with nearest 10p, 20p or 50p which is larger
    const priceOpts=[5,10,15,20,25,30,35,40,45];
    const price=priceOpts[Math.floor(Math.random()*priceOpts.length)];
    const payOptions=[10,20,50].filter(v=>v>price);
    const paid=payOptions[Math.floor(Math.random()*payOptions.length)];
    changeAmt=paid-price;
    document.getElementById('item-emoji').innerText=item.e;
    document.getElementById('scenario-text').innerHTML=`A ${item.n} costs <strong>${price}p</strong>.<br>You pay with a <strong>${paid}p</strong> coin.`;
    setTimeout(()=>document.getElementById('answer-input').focus(),50);
}
document.addEventListener('DOMContentLoaded',()=>{
    document.getElementById('answer-input').addEventListener('keydown',e=>{if(e.key==='Enter')checkAnswer();});
});
function checkAnswer(){
    const val=parseInt(document.getElementById('answer-input').value);
    if(isNaN(val)){document.getElementById('feedback').innerText='Type a number!';return;}
    if(val===changeAmt){score+=10;document.getElementById('score').innerText=score;document.getElementById('feedback').innerText='‚úÖ Correct!';confetti({particleCount:30,spread:60,origin:{y:0.5}});}
    else{document.getElementById('feedback').innerText=`‚ùå Change was ${changeAmt}p`;}
    setTimeout(nextQ,1200);
}
function endGame(){document.getElementById('game').classList.add('hidden');document.getElementById('end-screen').classList.remove('hidden');document.getElementById('final-score').innerText=score;confetti({particleCount:200,spread:120,origin:{y:0.5}});}
function finishLesson(){window.parent.postMessage({type:'lessonCompleted',lessonId:LESSON_ID},'*');}
</script>
</body>
</html>
